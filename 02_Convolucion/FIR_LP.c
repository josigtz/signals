/**************************************************************
WinFilter version 0.8
http://www.winfilter.20m.com
akundert@hotmail.com

Filter type: Low Pass
Filter model: Butterworth
Filter order: 2
Sampling Frequency: 44 KHz
Cut Frequency: 2.000000 KHz
Coefficents Quantization: float

Z domain Zeros
z = -1.000000 + j 0.000000
z = -1.000000 + j 0.000000

Z domain Poles
z = 0.800546 + j -0.165816
z = 0.800546 + j 0.165816
***************************************************************/
#define Ntap 100

float fir(float NewSample) {
    float FIRCoef[Ntap] = { 
        -0.00000178113354852065,
        -0.00000224588747410440,
        -0.00000271472622629143,
        -0.00000313723722139773,
        -0.00000344039728173786,
        -0.00000352428126061278,
        -0.00000325841026716052,
        -0.00000247949938662643,
        -0.00000099162897870096,
        0.00000142983920753558,
        0.00000502896399450134,
        0.00001005259713734588,
        0.00001672420978614415,
        0.00002520578228236570,
        0.00003554535706056597,
        0.00004760810214594225,
        0.00006098935333082426,
        0.00007490923654071708,
        0.00008809028152364435,
        0.00009862210672043363,
        0.00010382097801177463,
        0.00010009701568820940,
        0.00008284822028169607,
        0.00004640843982283504,
        -0.00001591403981869124,
        -0.00011165950572018912,
        -0.00024884127499832102,
        -0.00043529827191622367,
        -0.00067768924271664895,
        -0.00098003018803554743,
        -0.00134166755163082840,
        -0.00175457579056821070,
        -0.00219987201084967780,
        -0.00264345587780891050,
        -0.00303071413747229390,
        -0.00328028051850162230,
        -0.00327691864185193680,
        -0.00286370310689565420,
        -0.00183381713952390580,
        0.00007753177958932108,
        0.00320035152711716340,
        0.00793526583071723150,
        0.01475577544336485900,
        0.02420574493755024700,
        0.03689013234794486000,
        0.05345664318492362300,
        0.07456570197264934800,
        0.10084594091040609000,
        0.13283236745859986000,
        0.15031170190897533000,
        0.13283236745859986000,
        0.10084594091040609000,
        0.07456570197264934800,
        0.05345664318492362300,
        0.03689013234794486000,
        0.02420574493755024700,
        0.01475577544336485900,
        0.00793526583071723150,
        0.00320035152711716340,
        0.00007753177958932108,
        -0.00183381713952390580,
        -0.00286370310689565420,
        -0.00327691864185193680,
        -0.00328028051850162230,
        -0.00303071413747229390,
        -0.00264345587780891050,
        -0.00219987201084967780,
        -0.00175457579056821070,
        -0.00134166755163082840,
        -0.00098003018803554743,
        -0.00067768924271664895,
        -0.00043529827191622367,
        -0.00024884127499832102,
        -0.00011165950572018912,
        -0.00001591403981869124,
        0.00004640843982283504,
        0.00008284822028169607,
        0.00010009701568820940,
        0.00010382097801177463,
        0.00009862210672043363,
        0.00008809028152364435,
        0.00007490923654071708,
        0.00006098935333082426,
        0.00004760810214594225,
        0.00003554535706056597,
        0.00002520578228236570,
        0.00001672420978614415,
        0.00001005259713734588,
        0.00000502896399450134,
        0.00000142983920753558,
        -0.00000099162897870096,
        -0.00000247949938662643,
        -0.00000325841026716052,
        -0.00000352428126061278,
        -0.00000344039728173786,
        -0.00000313723722139773,
        -0.00000271472622629143,
        -0.00000224588747410440,
        -0.00000178113354852065,
        -0.00000135266186206961
    };

    static float x[Ntap]; //input samples
    float y=0;            //output sample
    int n;

    //shift the old samples
    for(n=Ntap-1; n>0; n--)
       x[n] = x[n-1];

    //Calculate the new output
    x[0] = NewSample;
    for(n=0; n<Ntap; n++)
        y += FIRCoef[n] * x[n];
    
    return y;
}
